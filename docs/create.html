<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create Property</title>
  <link rel="stylesheet" href="./css/styles.css" />
</head>
<body>
<header>
  <strong>Inspection Tracker</strong>
  <a href="./index.html">Home</a>
  <a href="./properties.html">Properties</a>
  <a href="./create.html">Create</a>
</header>

<main>
  <div class="card">
    <h1>Create Property</h1>
    <p class="small">MVP: manual ticks only. We’ll add upload/parsing and Supabase later.</p>
  </div>

  <form id="form" class="card">
    <label>Address</label>
    <input id="address" type="text" placeholder="e.g. 12 Example Street, Falkirk" required />

    <hr />

    <fieldset>
      <legend>Checklist Requirements</legend>

      <div class="chk"><input type="checkbox" id="isolator_required"> <label for="isolator_required">Isolator Required</label></div>
      <div class="chk"><input type="checkbox" id="power_issues"> <label for="power_issues">Power Issues</label></div>
      <div class="chk"><input type="checkbox" id="asbestos_survey"> <label for="asbestos_survey">Asbestos Survey</label></div>
      <div class="chk"><input type="checkbox" id="asbestos_removal"> <label for="asbestos_removal">Asbestos Removal</label></div>
      <div class="chk"><input type="checkbox" id="altro_flooring"> <label for="altro_flooring">Altro Flooring</label></div>
      <div class="chk"><input type="checkbox" id="heating_referral"> <label for="heating_referral">Heating Referral</label></div>
      <div class="chk"><input type="checkbox" id="rot_works"> <label for="rot_works">Rot Works</label></div>
      <div class="chk"><input type="checkbox" id="bathroom_renewal"> <label for="bathroom_renewal">Bathroom Renewal</label></div>
      <div class="chk"><input type="checkbox" id="epc"> <label for="epc">EPC</label></div>
      <div class="chk"><input type="checkbox" id="paint_lines"> <label for="paint_lines">Paint Lines</label></div>
      <div class="chk"><input type="checkbox" id="glazier"> <label for="glazier">Glazier</label></div>
      <div class="chk"><input type="checkbox" id="kitchen_renewal"> <label for="kitchen_renewal">Kitchen Renewal</label></div>
    </fieldset>

    <hr />

    <fieldset>
      <legend>Power Status (placeholder)</legend>
      <p class="small">For now just pick a status. Later we’ll build your BGAS state machine screens.</p>
      <select id="powerStatus">
        <option value="not_checked">Not checked</option>
        <option value="awaiting_meter_type">Awaiting meter type</option>
        <option value="meter_type_given">Meter type given</option>
        <option value="e10_needs_taken_over">E10: needs to be taken over</option>
        <option value="power_ready">Power ready</option>
      </select>
    </fieldset>

    <hr />
    <button class="btn" type="submit">Save Property (local)</button>
    <span class="small" id="msg"></span>
  </form>

  <script type="module">

import { supabase } from "./js/supabaseClient.js";
import { requireAuth } from "./js/authGate.js";

await requireAuth();

document.querySelector("#form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const payload = {
    address: document.querySelector("#address").value.trim(),
    isolator_required: document.querySelector("#isolator_required").checked,
    power_issues: document.querySelector("#power_issues").checked,
    asbestos_survey: document.querySelector("#asbestos_survey").checked,
    asbestos_removal: document.querySelector("#asbestos_removal").checked,
    altro_flooring: document.querySelector("#altro_flooring").checked,
    heating_referral: document.querySelector("#heating_referral").checked,
    rot_works: document.querySelector("#rot_works").checked,
    bathroom_renewal: document.querySelector("#bathroom_renewal").checked,
    epc: document.querySelector("#epc").checked,
    paint_lines: document.querySelector("#paint_lines").checked,
    glazier: document.querySelector("#glazier").checked,
    kitchen_renewal: document.querySelector("#kitchen_renewal").checked,
    power_status: document.querySelector("#powerStatus").value
  };

  const { error } = await supabase.from("properties").insert(payload);

  if (error) {
    alert(error.message);
    return;
  }
  window.location.href = "./properties.html";
});

  </script>
</main>
</body>
</html>

