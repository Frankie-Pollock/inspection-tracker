<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Property</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
<header>
  <strong>Inspection Tracker</strong>
  <a href="./index.html">Home</a>
 e.htmlCreate</a>
</header>

<main>
  <script type="module">
    import { requireAuth } from "./js/authGate.js";
    await requireAuth();
  </script>

  <div class="card">
    <h1 id="title">Property</h1>
    <p class="small" id="meta"></p>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Checklist</h2>
      <div id="req"></div>
    </div>

    <div class="card">
      <h2>Next Actions</h2>
      <ol id="actions"></ol>
    </div>
  </div>

  <script type="module">
    import { supabase } from "./js/supabaseClient.js";
    import { requireAuth } from "./js/authGate.js";
    import { computeNextActions } from "./js/app.js";

    await requireAuth();

    const id = new URLSearchParams(location.search).get("id");

    const { data, error } = await supabase
      .from("properties")
      .select("*")
      .eq("id", id)
      .single();

    if (error) {
      document.querySelector("#title").textContent = "Not found";
      document.querySelector("#meta").textContent = error.message;
      throw error;
    }

    const p = data;

    document.querySelector("#title").textContent = p.address;
    document.querySelector("#meta").textContent =
      `Power: ${p.power_status} â€¢ Created: ${new Date(p.created_at).toLocaleString()}`;

    // Render checklist
    const reqDiv = document.querySelector("#req");
    for (const [key, value] of Object.entries(p)) {
      if (typeof value === "boolean") {
        const div = document.createElement("div");
        div.className = "chk";
        div.innerHTML = `<span class="badge">${value ? "Yes" : "No"}</span> ${key}`;
        reqDiv.appendChild(div);
      }
    }

    // Render next actions (placeholder logic for now)
    const actions = computeNextActions({
      powerStatus: p.power_status,
      requirements: p
    });

    const ol = document.querySelector("#actions");
    actions.forEach(a => {
      const li = document.createElement("li");
      li.textContent = a;
      ol.appendChild(li);
    });
  </script>
</main>
</body>
</html>
