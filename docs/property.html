<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Property</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
<header>
  <strong>Inspection Tracker</strong>
  <a href="./index.html">Home</a>
  <a href="./properties.html">Properties</a>
  <a href="./create.html">Create</a>
</header>

<main>
  <div class="card">
    <h1 id="title">Property</h1>
    <p class="small" id="meta"></p>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Checklist</h2>
      <div id="req"></div>
    </div>

    <div class="card">
      <h2>Next Actions</h2>
      <ol id="actions"></ol>
    </div>
  </div>

  <script type="module">
    import { supabase } from "./js/supabaseClient.js";
    import { requireAuth } from "./js/authGate.js";
    import { POWER_STATES, buildTaskSeed, applyRules, nextActions } from "./js/workflow.js";

    await requireAuth();

    const id = new URLSearchParams(location.search).get("id");

    const title = document.querySelector("#title");
    const meta = document.querySelector("#meta");
    const reqDiv = document.querySelector("#req");
    const actionsOl = document.querySelector("#actions");
    const grid = document.querySelector(".grid");

    // --- Inject Power / BGAS card (NO account number) ---
    const powerCard = document.createElement("div");
    powerCard.className = "card";
    powerCard.innerHTML = `
      <h2>Power / BGAS</h2>

      <label>Status</label>
      <select id="p_status"></select>

      <label>Meter Type (optional)</label>
      <select id="p_meter">
        <option value="">â€”</option>
        <option value="credit">Credit</option>
        <option value="payg">PAYG</option>
        <option value="rti_keymeter">RTI KEYMETER</option>
        <option value="e10">E10</option>
      </select>

      <div class="chk">
        <input type="checkbox" id="p_taken" />
        <label>Supply taken over (E10)</label>
      </div>

      <label>Notes</label>
      <input id="p_notes" type="text" placeholder="e.g. Awaiting meter type from BGAS (date)" />

